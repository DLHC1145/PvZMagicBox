<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>è½¯ä»¶æœç´¢ä¸‹è½½</title>
  <style>
	* {
	  margin: 0;
	  padding: 0;
	  box-sizing: border-box;
	}

	body {
	  font-family: Arial, sans-serif;
	  background-color: #f5f5f5;
	  padding: 0;
	  touch-action: pan-x pan-y;
	  overflow-x: hidden;
	  min-height: 100vh;
	  position: relative;
	  overflow: hidden;
	}

	html {
	  touch-action: manipulation;
	  -webkit-text-size-adjust: none;
	  -ms-text-size-adjust: none;
	  text-size-adjust: none;
	}

	.afdian-container {
	  width: 100%;
	  height: 100vh;
	  border: none;
	  overflow: auto;
	  display: block;
	  position: relative;
	  z-index: 1;
	  min-height: calc(100vh - 60px);
	}

	.bottom-nav {
	  position: fixed;
	  bottom: 0;
	  left: 0;
	  width: 100%;
	  height: 60px;
	  background-color: #fff;
	  border-top: 1px solid #e5e5e5;
	  display: flex;
	  justify-content: space-around;
	  align-items: center;
	  z-index: 9999;
	  pointer-events: auto;
	  transform: translateZ(0);
	  -webkit-transform: translateZ(0);
	  overflow: hidden;
	  opacity: 1 !important;
	  visibility: visible !important;
	}

	.nav-item {
	  display: flex;
	  flex-direction: column;
	  align-items: center;
	  justify-content: center;
	  flex: 1;
	  height: 100%;
	  text-decoration: none;
	  color: #999;
	  transition: color 0.3s;
	  pointer-events: auto;
	  white-space: nowrap;
	}

	.nav-item.active {
	  color: #4CAF50;
	}

	.nav-icon {
	  width: 24px;
	  height: 24px;
	  margin-bottom: 4px;
	  font-size: 20px;
	  display: flex;
	  align-items: center;
	  justify-content: center;
	}

	.nav-icon img {
	  width: 100%;
	  height: 100%;
	  object-fit: contain;
	  transition: opacity 0.3s;
	}

	.nav-text {
	  font-size: 12px;
	  -webkit-font-smoothing: antialiased;
	}

	.wechat-notification,
	.copy-success-modal,
	.modal-overlay,
	.terms-overlay,
	.loading-overlay,
	.nav-safe-indicator {
	  display: none !important;
	}
	
	/* å¯¼èˆªæ åŠ è½½å¤±è´¥æç¤º */
	.nav-load-error {
	  position: fixed;
	  bottom: 60px;
	  left: 0;
	  width: 100%;
	  background-color: #f44336;
	  color: white;
	  padding: 8px 15px;
	  font-size: 14px;
	  text-align: center;
	  z-index: 9998;
	}
  </style>
</head>
<body>
  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <iframe
	class="afdian-container"
	src="https://dlhc1145.github.io/PvZMagicBox"
	allowfullscreen
  ></iframe>

  <!-- å†…ç½®å¯¼èˆªæ  -->
  <div id="bottomNav" class="bottom-nav">
	<a href="indexhome.html" class="nav-item active" onclick="handleNavigation(0, event)">
	  <div class="nav-icon">
		<img src="home.png" alt="ä¸»é¡µ" onerror="this.style.display='none'; this.parentNode.innerHTML='ğŸ '; this.parentNode.style.fontSize='20px'; this.parentNode.style.display='flex'; this.parentNode.style.alignItems='center'; this.parentNode.style.justifyContent='center';">
	  </div>
	  <div class="nav-text">ä¸»é¡µ</div>
	</a>
	<a href="index2.html" class="nav-item" onclick="handleNavigation(1, event)">
	  <div class="nav-icon">
		<img src="author.png" alt="å‘ç°" onerror="this.style.display='none'; this.parentNode.innerHTML='ğŸ”'; this.parentNode.style.fontSize='20px'; this.parentNode.style.display='flex'; this.parentNode.style.alignItems='center'; this.parentNode.style.justifyContent='center';">
	  </div>
	  <div class="nav-text">å‘ç°</div>
	</a>
	<a href="index3.html" class="nav-item" onclick="handleNavigation(2, event)">
	  <div class="nav-icon">
		<img src="my.png" alt="æˆ‘çš„" onerror="this.style.display='none'; this.parentNode.innerHTML='ğŸ‘¤'; this.parentNode.style.fontSize='20px'; this.parentNode.style.display='flex'; this.parentNode.style.alignItems='center'; this.parentNode.style.justifyContent='center';">
	  </div>
	  <div class="nav-text">æˆ‘çš„</div>
	</a>
  </div>

  <script>
	/*********************** å¯é…ç½®çš„åº•éƒ¨å¯¼èˆª *************************/
	const NAV_CONFIG = [
	  { 
		icon: 'home.png', 
		text: { zh: 'ä¸»é¡µ', en: 'Home' }, 
		link: 'indexhome.html', 
		active: true 
	  },
	  { 
		icon: 'author.png', 
		text: { zh: 'å‘ç°', en: 'Discover ' }, 
		link: 'index2.html' 
	  },
	  { 
		icon: 'my.png', 
		text: { zh: 'æˆ‘çš„', en: 'Profile' }, 
		link: 'index3.html' 
	  }
	];
	// ===========================================

	let isEnglishMode = false;

	// ================== é…ç½®åŒº ==================
	const CACHE_EXPIRY_MS = 10 * 60 * 1000; // ç¼“å­˜ä¿å­˜æ—¶é—´ï¼š10åˆ†é’Ÿ
	const CHECK_INTERVAL_MS = 5 * 60 * 1000; // å…œåº•æ£€æŸ¥ï¼šæ¯5åˆ†é’Ÿ
	const STORAGE_KEY = 'lastUnloadTime';
	// ===========================================

	function getLanguageState() {
	  return localStorage.getItem('isEnglish') === 'true';
	}

	function updateBottomNav() {
	  isEnglishMode = getLanguageState();
	  const navItems = document.querySelectorAll('.bottom-nav .nav-item');
	  
	  NAV_CONFIG.forEach((item, index) => {
		const navItem = navItems[index];
		if (!navItem) return;
		
		const text = isEnglishMode ? item.text.en : item.text.zh;
		const iconContainer = navItem.querySelector('.nav-icon');
		const textContainer = navItem.querySelector('.nav-text');
		const img = iconContainer.querySelector('img');

		// æ›´æ–°å¯¼èˆªé¡¹å±æ€§
		navItem.href = item.link;
		textContainer.textContent = text;
		if (img) {
		  img.src = item.icon;
		  img.alt = text;
		  // å›¾ç‰‡åŠ è½½å¤±è´¥å¤„ç†
		  img.onerror = function() {
			this.style.display = 'none';
			iconContainer.innerHTML = 'ğŸ“';
			iconContainer.style.fontSize = '20px';
			iconContainer.style.display = 'flex';
			iconContainer.style.alignItems = 'center';
			iconContainer.style.justifyContent = 'center';
		  };
		}
		navItem.classList.toggle('active', item.active);
	  });
	}

	function handleNavigation(index, event) {
	  event.preventDefault();
	  const navItems = document.querySelectorAll('.bottom-nav .nav-item');
	  
	  navItems.forEach((item, i) => {
		item.classList.toggle('active', i === index);
	  });
	  setTimeout(() => {
		window.location.href = NAV_CONFIG[index].link;
	  }, 50);
	}

	// ========== ååˆ†é’Ÿè‡ªåŠ¨æ¸…ç¼“å­˜å¹¶åˆ·æ–° ==========
	function recordUnloadTime() {
	  try {
		localStorage.setItem(STORAGE_KEY, Date.now().toString());
	  } catch (e) {
		// å¿½ç•¥éšç§æ¨¡å¼/å­˜å‚¨å¼‚å¸¸
	  }
	}

	function getLastUnloadTime() {
	  try {
		const t = localStorage.getItem(STORAGE_KEY);
		return t ? Number(t) : 0;
	  } catch (e) {
		return 0;
	  }
	}

	function checkAndRefreshIfExpired() {
	  const now = Date.now();
	  const last = getLastUnloadTime();
	  if (now - last > CACHE_EXPIRY_MS) {
		// æ¸…ç†å­˜å‚¨
		localStorage.clear();
		sessionStorage.clear();
		// è§¦å‘é¡µé¢é‡æ–°åŠ è½½
		window.location.reload();
	  }
	}

	function onVisibilityChange() {
	  if (document.visibilityState === 'visible') {
		checkAndRefreshIfExpired();
	  }
	}

	// å…œåº•ï¼šå®šæ—¶æ£€æŸ¥
	let intervalId = setInterval(checkAndRefreshIfExpired, CHECK_INTERVAL_MS);

	// ç»‘å®šäº‹ä»¶
	document.addEventListener('visibilitychange', onVisibilityChange);
	window.addEventListener('pageshow', onVisibilityChange);
	window.addEventListener('pagehide', recordUnloadTime);
	window.addEventListener('beforeunload', recordUnloadTime);

	// åˆå§‹åŒ–
	document.addEventListener('DOMContentLoaded', () => {
	  // åˆå§‹åŒ–å†…ç½®å¯¼èˆªæ 
	  updateBottomNav();
	  
	  // è®¾ç½®å®šæœŸæ£€æŸ¥å¯¼èˆªæ æ›´æ–°
	  setInterval(updateBottomNav, CHECK_INTERVAL_MS);
	  
	  // é¦–æ¬¡æ£€æŸ¥ç¼“å­˜
	  setTimeout(checkAndRefreshIfExpired, 300);
	  console.log('ğŸ”§ å†…ç½®å¯¼èˆªç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
	});

	// ç¦æ­¢iframeæ»šåŠ¨å†’æ³¡
	document
	  .querySelector('.afdian-container')
	  .addEventListener('scroll', function (e) {
		e.stopPropagation();
	  });
  </script>
</body>
</html>