<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>JSONæ–‡ä»¶å¤„ç†å·¥å…·</title>
	<style>
		* {
			box-sizing: border-box;
			margin: 0;
			padding: 0;
			font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
		}
		
		body {
			background-color: #f8f9fa;
			color: #333;
			min-height: 100vh;
			padding: 20px;
			display: flex;
			justify-content: center;
			align-items: center;
		}
		
		.container {
			background-color: white;
			border-radius: 8px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
			width: 100%;
			max-width: 600px;
			padding: 30px;
			text-align: center;
		}
		
		h1 {
			color: #2c3e50;
			margin-bottom: 15px;
			font-size: 24px;
			font-weight: 600;
		}
		
		.description {
			color: #6c757d;
			margin-bottom: 25px;
			line-height: 1.5;
			font-size: 15px;
		}
		
		.upload-area {
			border: 1px dashed #dee2e6;
			border-radius: 6px;
			padding: 30px 20px;
			margin-bottom: 20px;
			cursor: pointer;
			transition: all 0.2s;
			background-color: #f8f9fa;
		}
		
		.upload-area:hover {
			background-color: #e9ecef;
			border-color: #adb5bd;
		}
		
		.upload-area.highlight {
			background-color: #e7f3ff;
			border-color: #0d6efd;
		}
		
		.upload-icon {
			font-size: 40px;
			color: #6c757d;
			margin-bottom: 10px;
		}
		
		.file-input {
			display: none;
		}
		
		.btn {
			background-color: #0d6efd;
			color: white;
			border: none;
			padding: 10px 20px;
			border-radius: 4px;
			cursor: pointer;
			font-size: 14px;
			transition: background-color 0.2s;
			margin: 8px 5px;
			font-weight: 500;
		}
		
		.btn:hover {
			background-color: #0b5ed7;
		}
		
		.btn:disabled {
			background-color: #6c757d;
			cursor: not-allowed;
		}
		
		.btn-download {
			background-color: #198754;
		}
		
		.btn-download:hover {
			background-color: #157347;
		}
		
		.status {
			margin-top: 20px;
			padding: 12px;
			border-radius: 4px;
			display: none;
			font-size: 14px;
		}
		
		.status.success {
			background-color: #d1e7dd;
			color: #0f5132;
			display: block;
		}
		
		.status.error {
			background-color: #f8d7da;
			color: #721c24;
			display: block;
		}
		
		.file-info {
			margin-top: 15px;
			font-size: 14px;
			color: #6c757d;
		}
		
		.processing {
			display: none;
			margin: 20px 0;
		}
		
		.spinner {
			border: 3px solid rgba(0, 0, 0, 0.1);
			border-radius: 50%;
			border-top: 3px solid #0d6efd;
			width: 24px;
			height: 24px;
			animation: spin 1s linear infinite;
			margin: 0 auto 10px;
		}
		
		@keyframes spin {
			0% { transform: rotate(0deg); }
			100% { transform: rotate(360deg); }
		}
		
		.instructions {
			background-color: #f8f9fa;
			border-left: 3px solid #0d6efd;
			padding: 15px;
			margin: 20px 0;
			text-align: left;
			border-radius: 0 4px 4px 0;
			font-size: 14px;
		}
		
		.instructions h3 {
			color: #2c3e50;
			margin-bottom: 10px;
			font-size: 16px;
		}
		
		.instructions ul {
			padding-left: 20px;
		}
		
		.instructions li {
			margin-bottom: 8px;
			color: #6c757d;
		}
		
		.preview {
			margin-top: 20px;
			text-align: left;
			display: none;
		}
		
		.preview h3 {
			color: #2c3e50;
			margin-bottom: 10px;
			font-size: 16px;
		}
		
		.preview-content {
			background-color: #f8f9fa;
			border: 1px solid #e9ecef;
			border-radius: 4px;
			padding: 15px;
			max-height: 200px;
			overflow-y: auto;
			font-family: 'Courier New', monospace;
			font-size: 12px;
			white-space: pre-wrap;
		}
	</style>
</head>
<body>
	<div class="container">
		<h1>JSONæ–‡ä»¶å¤„ç†å·¥å…·</h1>
		<p class="description">ä¸Šä¼ JSONæ–‡ä»¶ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨åˆ é™¤åŒ…å«"768"çš„å­—æ®µï¼Œç„¶åæ‚¨å¯ä»¥ä¸‹è½½å¤„ç†åçš„æ–‡ä»¶ã€‚</p>
		
		<div class="instructions">
			<h3>ä½¿ç”¨è¯´æ˜ï¼š</h3>
			<ul>
				<li>ç‚¹å‡»ä¸Šä¼ åŒºåŸŸæˆ–æŒ‰é’®é€‰æ‹©JSONæ–‡ä»¶</li>
				<li>ç³»ç»Ÿå°†è‡ªåŠ¨å¤„ç†æ–‡ä»¶ï¼Œåˆ é™¤æ‰€æœ‰åŒ…å«"768"çš„å­—æ®µ</li>
				<li>å¤„ç†å®Œæˆåï¼Œä¸‹è½½æŒ‰é’®å°†å˜ä¸ºå¯ç”¨çŠ¶æ€</li>
				<li>ç‚¹å‡»ä¸‹è½½æŒ‰é’®è·å–å¤„ç†åçš„æ–‡ä»¶</li>
			</ul>
		</div>
		
		<div id="uploadArea" class="upload-area">
			<div class="upload-icon">ğŸ“</div>
			<p>æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </p>
			<input type="file" id="fileInput" class="file-input" accept=".json,.txt">
		</div>
		
		<button id="uploadBtn" class="btn">é€‰æ‹©æ–‡ä»¶</button>
		
		<div id="processing" class="processing">
			<div class="spinner"></div>
			<p>æ­£åœ¨å¤„ç†æ–‡ä»¶...</p>
		</div>
		
		<div id="status" class="status"></div>
		
		<div id="fileInfo" class="file-info"></div>
		
		<div id="preview" class="preview">
			<h3>å¤„ç†é¢„è§ˆï¼š</h3>
			<div id="previewContent" class="preview-content"></div>
		</div>
		
		<button id="downloadBtn" class="btn btn-download" disabled>ä¸‹è½½å¤„ç†åçš„æ–‡ä»¶</button>
	</div>

	<script>
		// å®šä¹‰å®Œæ•´çš„Blobæ„é€ å‡½æ•°ï¼Œç¡®ä¿å…¼å®¹æ€§
		if (typeof Blob === 'undefined') {
			window.Blob = function(parts, properties) {
				properties = properties || {};
				var type = properties.type || '';
				var endings = properties.endings || 'transparent';
				
				var blob = new (window.BlobBuilder || window.WebKitBlobBuilder || window.MozBlobBuilder || window.MSBlobBuilder)();
				
				if (blob.append) {
					for (var i = 0; i < parts.length; i++) {
						blob.append(parts[i]);
					}
					return blob.getBlob(type);
				}
				
				// å¦‚æœä»¥ä¸Šéƒ½ä¸æ”¯æŒï¼Œè¿”å›ä¸€ä¸ªæ¨¡æ‹Ÿçš„Blobå¯¹è±¡
				return {
					size: parts.reduce(function(size, part) {
						return size + (part.size || part.length || 0);
					}, 0),
					type: type,
					slice: function() {
						console.warn('Blob.slice() not supported in this browser');
						return null;
					}
				};
			};
		}

		// ç¡®ä¿URL.createObjectURLå­˜åœ¨
		if (!window.URL) {
			window.URL = window.URL || window.webkitURL;
		}
		
		if (!URL.createObjectURL) {
			URL.createObjectURL = function(blob) {
				if (window.webkitURL) {
					return window.webkitURL.createObjectURL(blob);
				} else if (window.URL && window.URL.createObjectURL) {
					return window.URL.createObjectURL(blob);
				} else {
					// å¦‚æœä¸æ”¯æŒcreateObjectURLï¼Œä½¿ç”¨æ•°æ®URL
					return 'data:application/octet-stream;base64,' + btoa(blob);
				}
			};
		}

		// ç¡®ä¿FileReaderå­˜åœ¨
		if (!window.FileReader) {
			window.FileReader = function() {
				this.readAsText = function(file) {
					// æ¨¡æ‹ŸFileReaderåŠŸèƒ½
					var self = this;
					setTimeout(function() {
						if (self.onload) {
							self.onload({target: {result: 'FileReader not supported'}});
						}
					}, 100);
				};
			};
		}

		document.addEventListener('DOMContentLoaded', function() {
			const uploadArea = document.getElementById('uploadArea');
			const fileInput = document.getElementById('fileInput');
			const uploadBtn = document.getElementById('uploadBtn');
			const downloadBtn = document.getElementById('downloadBtn');
			const statusDiv = document.getElementById('status');
			const fileInfoDiv = document.getElementById('fileInfo');
			const processingDiv = document.getElementById('processing');
			const previewDiv = document.getElementById('preview');
			const previewContent = document.getElementById('previewContent');
			
			let processedContent = null;
			let originalFileName = '';
			
			// ç‚¹å‡»ä¸Šä¼ åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©
			uploadArea.addEventListener('click', function() {
				fileInput.click();
			});
			
			// ç‚¹å‡»ä¸Šä¼ æŒ‰é’®è§¦å‘æ–‡ä»¶é€‰æ‹©
			uploadBtn.addEventListener('click', function() {
				fileInput.click();
			});
			
			// æ‹–æ”¾åŠŸèƒ½
			['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
				uploadArea.addEventListener(eventName, preventDefaults, false);
			});
			
			function preventDefaults(e) {
				e.preventDefault();
				e.stopPropagation();
			}
			
			['dragenter', 'dragover'].forEach(eventName => {
				uploadArea.addEventListener(eventName, highlight, false);
			});
			
			['dragleave', 'drop'].forEach(eventName => {
				uploadArea.addEventListener(eventName, unhighlight, false);
			});
			
			function highlight() {
				uploadArea.classList.add('highlight');
			}
			
			function unhighlight() {
				uploadArea.classList.remove('highlight');
			}
			
			// å¤„ç†æ–‡ä»¶æ‹–æ”¾
			uploadArea.addEventListener('drop', handleDrop, false);
			
			function handleDrop(e) {
				const dt = e.dataTransfer;
				const files = dt.files;
				handleFiles(files);
			}
			
			// å¤„ç†æ–‡ä»¶é€‰æ‹©
			fileInput.addEventListener('change', function() {
				handleFiles(this.files);
			});
			
			function handleFiles(files) {
				if (files.length === 0) return;
				
				const file = files[0];
				originalFileName = file.name;
				
				// æ£€æŸ¥æ–‡ä»¶ç±»å‹
				if (!file.name.endsWith('.json') && !file.name.endsWith('.txt')) {
					statusDiv.textContent = 'è¯·é€‰æ‹©JSONæ–‡ä»¶æˆ–æ–‡æœ¬æ–‡ä»¶';
					statusDiv.className = 'status error';
					return;
				}
				
				// æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
				fileInfoDiv.textContent = `å·²é€‰æ‹©æ–‡ä»¶: ${file.name} (${formatFileSize(file.size)})`;
				
				// æ˜¾ç¤ºå¤„ç†ä¸­çŠ¶æ€
				processingDiv.style.display = 'block';
				statusDiv.className = 'status';
				downloadBtn.disabled = true;
				previewDiv.style.display = 'none';
				
				// è¯»å–æ–‡ä»¶å†…å®¹
				const reader = new FileReader();
				
				reader.onload = function(e) {
					try {
						const content = e.target.result;
						
						// å¤„ç†æ–‡ä»¶å†…å®¹ - åˆ é™¤åŒ…å«"768"çš„å­—æ®µ
						processedContent = processJSONContent(content);
						
						// æ˜¾ç¤ºé¢„è§ˆ
						previewContent.textContent = processedContent.substring(0, 1000) + (processedContent.length > 1000 ? '...' : '');
						previewDiv.style.display = 'block';
						
						// æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
						statusDiv.textContent = 'æ–‡ä»¶å¤„ç†æˆåŠŸï¼';
						statusDiv.className = 'status success';
						downloadBtn.disabled = false;
					} catch (error) {
						// æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
						statusDiv.textContent = 'å¤„ç†æ–‡ä»¶æ—¶å‡ºé”™: ' + error.message;
						statusDiv.className = 'status error';
					} finally {
						processingDiv.style.display = 'none';
					}
				};
				
				reader.onerror = function() {
					statusDiv.textContent = 'è¯»å–æ–‡ä»¶æ—¶å‡ºé”™';
					statusDiv.className = 'status error';
					processingDiv.style.display = 'none';
				};
				
				reader.readAsText(file);
			}
			
			function processJSONContent(content) {
				// è§£æJSON
				const data = JSON.parse(content);
				
				// å¤„ç†JSONæ•°æ®ï¼Œåˆ é™¤åŒ…å«"768"çš„å­—æ®µ
				const processedData = processJSONObject(data);
				
				// è¿”å›æ ¼å¼åŒ–çš„JSON
				return JSON.stringify(processedData, null, 2);
			}
			
			function processJSONObject(obj) {
				if (typeof obj !== 'object' || obj === null) return obj;
				
				if (Array.isArray(obj)) {
					// å¤„ç†æ•°ç»„
					const result = [];
					for (const item of obj) {
						// æ£€æŸ¥æ•°ç»„é¡¹æ˜¯å¦ä¸ºå¯¹è±¡ä¸”åŒ…å«"ID"å­—æ®µ
						if (typeof item === 'object' && item !== null && item.ID) {
							// è·³è¿‡åŒ…å«"768"çš„ID
							if (!item.ID.includes('768')) {
								result.push(processJSONObject(item));
							}
						} else {
							result.push(processJSONObject(item));
						}
					}
					return result;
				} else {
					// å¤„ç†å¯¹è±¡
					const result = {};
					for (const [key, value] of Object.entries(obj)) {
						// è·³è¿‡åŒ…å«"768"çš„é”®
						if (!key.includes('768')) {
							result[key] = processJSONObject(value);
						}
					}
					return result;
				}
			}
			
			function formatFileSize(bytes) {
				if (bytes === 0) return '0 Bytes';
				const k = 1024;
				const sizes = ['Bytes', 'KB', 'MB', 'GB'];
				const i = Math.floor(Math.log(bytes) / Math.log(k));
				return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
			}
			
			// ä¸‹è½½å¤„ç†åçš„æ–‡ä»¶
			downloadBtn.addEventListener('click', function() {
				if (!processedContent) return;
				
				try {
					// åˆ›å»ºä¸‹è½½é“¾æ¥ - ä½¿ç”¨å®Œæ•´çš„Blobç±»å‹å®šä¹‰
					const blob = new Blob([processedContent], { 
						type: 'application/json;charset=utf-8'
					});
					
					// ç¡®ä¿URL.createObjectURLå¯ç”¨
					if (URL && URL.createObjectURL) {
						const url = URL.createObjectURL(blob);
						const a = document.createElement('a');
						a.href = url;
						
						// ç”Ÿæˆæ–°çš„æ–‡ä»¶å
						const nameWithoutExt = originalFileName.lastIndexOf('.') > 0 ? 
							originalFileName.substring(0, originalFileName.lastIndexOf('.')) : 
							originalFileName;
						
						a.download = `${nameWithoutExt}_processed.json`;
						a.style.display = 'none';
						
						// è§¦å‘ä¸‹è½½
						document.body.appendChild(a);
						a.click();
						document.body.removeChild(a);
						
						// æ¸…ç†URL
						setTimeout(function() {
							URL.revokeObjectURL(url);
						}, 100);
					} else {
						// å¦‚æœä¸æ”¯æŒcreateObjectURLï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ³•
						const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(processedContent);
						const a = document.createElement('a');
						a.href = dataStr;
						
						const nameWithoutExt = originalFileName.lastIndexOf('.') > 0 ? 
							originalFileName.substring(0, originalFileName.lastIndexOf('.')) : 
							originalFileName;
						
						a.download = `${nameWithoutExt}_processed.json`;
						a.style.display = 'none';
						document.body.appendChild(a);
						a.click();
						document.body.removeChild(a);
					}
				} catch (error) {
					console.error('ä¸‹è½½é”™è¯¯:', error);
					statusDiv.textContent = 'ä¸‹è½½æ–‡ä»¶æ—¶å‡ºé”™: ' + error.message;
					statusDiv.className = 'status error';
				}
			});
		});
	</script>
</body>
</html>